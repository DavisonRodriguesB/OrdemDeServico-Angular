<div class="p-6">

  <!-- Header -->
  <div class="mb-6">
    <h1 class="text-3xl font-bold text-gray-700">Alocação de Serviços</h1>
    <p class="text-gray-500">
      Associe uma ordem de serviço a uma equipe disponível
    </p>
  </div>

  <!-- Card -->
  <div class="bg-white rounded-xl shadow-sm p-8 border border-gray-200 space-y-6">

    <!-- Mensagens -->
    <div *ngIf="errorMessage" class="bg-red-100 text-red-700 px-4 py-2 rounded">
      {{ errorMessage }}
    </div>

    <div *ngIf="successMessage" class="bg-green-100 text-green-700 px-4 py-2 rounded">
      {{ successMessage }}
    </div>

    <!-- Linha 1: OS + Equipe -->
    <div class="grid grid-cols-1 md:grid-cols-2 gap-6">

      <!-- Ordem de Serviço -->
      <div>
        <label class="block text-sm font-medium text-gray-700 mb-1">
          Ordem de Serviço
        </label>

        <select
          [(ngModel)]="selectedServiceOrderId"
          (ngModelChange)="onServiceOrderChange()"
          class="w-full px-3 py-2 border border-gray-300 rounded-lg text-sm"
        >
          <option [ngValue]="null">Selecione a ordem de serviço</option>

          <option *ngFor="let os of serviceOrders" [ngValue]="os.id">
            {{ os.os }} - {{ os.servico }} ({{ os.tipo }})
          </option>
        </select>
      </div>

      <!-- Equipe -->
      <div>
        <label class="block text-sm font-medium text-gray-700 mb-1">
          Equipe
        </label>

        <select
          [(ngModel)]="selectedTeamId"
          [disabled]="!filteredTeams.length"
          class="w-full px-3 py-2 border border-gray-300 rounded-lg text-sm disabled:bg-gray-100"
        >
          <option [ngValue]="null">
            {{ filteredTeams.length ? 'Selecione a equipe' : 'Selecione uma O.S primeiro' }}
          </option>

          <option *ngFor="let team of filteredTeams" [ngValue]="team.id">
            {{ team.nome }} - {{ team.tipoServico }}
          </option>
        </select>
      </div>

    </div>

    <!-- Linha 2: Detalhes da OS -->
    <div *ngIf="selectedServiceOrder" class="grid grid-cols-1 md:grid-cols-3 gap-6">

      <div>
        <label class="block text-sm font-medium text-gray-700 mb-1">
          Tipo de Serviço
        </label>
        <input
          type="text"
          disabled
          [value]="selectedServiceOrder.tipo"
          class="w-full px-3 py-2 bg-gray-100 border rounded-lg text-sm"
        />
      </div>

      <div>
        <label class="block text-sm font-medium text-gray-700 mb-1">
          Bairro
        </label>
        <input
          type="text"
          disabled
          [value]="selectedServiceOrder.bairro"
          class="w-full px-3 py-2 bg-gray-100 border rounded-lg text-sm"
        />
      </div>

      <div>
        <label class="block text-sm font-medium text-gray-700 mb-1">
          Prioridade
        </label>
        <input
          type="text"
          disabled
          [value]="selectedServiceOrder.prioridade"
          class="w-full px-3 py-2 bg-gray-100 border rounded-lg text-sm"
        />
      </div>

    </div>

    <!-- Ações -->
    <div class="flex justify-end gap-3 mt-8">
      <button
        (click)="cancelar()"
        class="px-4 py-2 border rounded-lg"
      >
        Cancelar
      </button>

      <button
        (click)="alocar()"
        [disabled]="!selectedServiceOrderId || !selectedTeamId"
        class="px-4 py-2 bg-blue-900 text-white rounded-lg disabled:bg-gray-400"
      >
        Alocar Serviço
      </button>
    </div>

  </div>

  <!-- Lista de Ordens Alocadas / Prévia Geral -->
  <div class="mt-6">
    <app-allocated-orders-list
      [teamId]="selectedTeamId">
    </app-allocated-orders-list>
  </div>

</div>
